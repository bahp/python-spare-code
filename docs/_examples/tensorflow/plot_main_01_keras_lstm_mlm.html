<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Serialization… &mdash; python-spare-code 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/python_icon_191765.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="01. Basic example" href="../tpot/main01.html" />
    <link rel="prev" title="Main" href="gunn_review_keras.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            python-spare-code
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">General</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#explainer-dashboard">Explainer Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#factory-boy">Factory Boy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#jsonpickle">jsonpickle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ldap">LDAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#matplotlib-seaborn">Matplotlib / Seaborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#other">Other</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#pandas">Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plotly">Plotly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#scikits">Scikits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#shap">Shap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tableone">TableOne</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#tensorflow">Tensorflow</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="gunn_review_keras.html">Main</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Serialization…</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tpot">TPOT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ukvi-trips">UKVI Trips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#utils">Utils</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">python-spare-code</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">General</a></li>
      <li class="breadcrumb-item active">Serialization…</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/_examples/tensorflow/plot_main_01_keras_lstm_mlm.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-tensorflow-plot-main-01-keras-lstm-mlm-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="serialization">
<span id="sphx-glr-examples-tensorflow-plot-main-01-keras-lstm-mlm-py"></span><h1>Serialization…<a class="headerlink" href="#serialization" title="Permalink to this heading"></a></h1>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>96 48
Epoch 1/100
94/94 - 1s - loss: 0.0496 - 1s/epoch - 16ms/step
Epoch 2/100
94/94 - 0s - loss: 0.0275 - 105ms/epoch - 1ms/step
Epoch 3/100
94/94 - 0s - loss: 0.0193 - 104ms/epoch - 1ms/step
Epoch 4/100
94/94 - 0s - loss: 0.0169 - 106ms/epoch - 1ms/step
Epoch 5/100
94/94 - 0s - loss: 0.0159 - 104ms/epoch - 1ms/step
Epoch 6/100
94/94 - 0s - loss: 0.0150 - 104ms/epoch - 1ms/step
Epoch 7/100
94/94 - 0s - loss: 0.0143 - 104ms/epoch - 1ms/step
Epoch 8/100
94/94 - 0s - loss: 0.0135 - 111ms/epoch - 1ms/step
Epoch 9/100
94/94 - 0s - loss: 0.0129 - 105ms/epoch - 1ms/step
Epoch 10/100
94/94 - 0s - loss: 0.0120 - 106ms/epoch - 1ms/step
Epoch 11/100
94/94 - 0s - loss: 0.0111 - 106ms/epoch - 1ms/step
Epoch 12/100
94/94 - 0s - loss: 0.0102 - 190ms/epoch - 2ms/step
Epoch 13/100
94/94 - 0s - loss: 0.0093 - 104ms/epoch - 1ms/step
Epoch 14/100
94/94 - 0s - loss: 0.0084 - 140ms/epoch - 1ms/step
Epoch 15/100
94/94 - 0s - loss: 0.0074 - 122ms/epoch - 1ms/step
Epoch 16/100
94/94 - 0s - loss: 0.0066 - 125ms/epoch - 1ms/step
Epoch 17/100
94/94 - 0s - loss: 0.0055 - 133ms/epoch - 1ms/step
Epoch 18/100
94/94 - 0s - loss: 0.0046 - 127ms/epoch - 1ms/step
Epoch 19/100
94/94 - 0s - loss: 0.0039 - 106ms/epoch - 1ms/step
Epoch 20/100
94/94 - 0s - loss: 0.0032 - 119ms/epoch - 1ms/step
Epoch 21/100
94/94 - 0s - loss: 0.0027 - 129ms/epoch - 1ms/step
Epoch 22/100
94/94 - 0s - loss: 0.0024 - 117ms/epoch - 1ms/step
Epoch 23/100
94/94 - 0s - loss: 0.0022 - 243ms/epoch - 3ms/step
Epoch 24/100
94/94 - 0s - loss: 0.0020 - 198ms/epoch - 2ms/step
Epoch 25/100
94/94 - 0s - loss: 0.0021 - 101ms/epoch - 1ms/step
Epoch 26/100
94/94 - 0s - loss: 0.0020 - 99ms/epoch - 1ms/step
Epoch 27/100
94/94 - 0s - loss: 0.0020 - 105ms/epoch - 1ms/step
Epoch 28/100
94/94 - 0s - loss: 0.0020 - 110ms/epoch - 1ms/step
Epoch 29/100
94/94 - 0s - loss: 0.0021 - 209ms/epoch - 2ms/step
Epoch 30/100
94/94 - 0s - loss: 0.0020 - 115ms/epoch - 1ms/step
Epoch 31/100
94/94 - 0s - loss: 0.0020 - 120ms/epoch - 1ms/step
Epoch 32/100
94/94 - 0s - loss: 0.0021 - 165ms/epoch - 2ms/step
Epoch 33/100
94/94 - 0s - loss: 0.0020 - 128ms/epoch - 1ms/step
Epoch 34/100
94/94 - 0s - loss: 0.0020 - 144ms/epoch - 2ms/step
Epoch 35/100
94/94 - 0s - loss: 0.0020 - 113ms/epoch - 1ms/step
Epoch 36/100
94/94 - 0s - loss: 0.0020 - 158ms/epoch - 2ms/step
Epoch 37/100
94/94 - 0s - loss: 0.0020 - 130ms/epoch - 1ms/step
Epoch 38/100
94/94 - 0s - loss: 0.0020 - 98ms/epoch - 1ms/step
Epoch 39/100
94/94 - 0s - loss: 0.0020 - 100ms/epoch - 1ms/step
Epoch 40/100
94/94 - 0s - loss: 0.0020 - 100ms/epoch - 1ms/step
Epoch 41/100
94/94 - 0s - loss: 0.0020 - 149ms/epoch - 2ms/step
Epoch 42/100
94/94 - 0s - loss: 0.0020 - 145ms/epoch - 2ms/step
Epoch 43/100
94/94 - 0s - loss: 0.0020 - 110ms/epoch - 1ms/step
Epoch 44/100
94/94 - 0s - loss: 0.0020 - 97ms/epoch - 1ms/step
Epoch 45/100
94/94 - 0s - loss: 0.0021 - 114ms/epoch - 1ms/step
Epoch 46/100
94/94 - 0s - loss: 0.0019 - 128ms/epoch - 1ms/step
Epoch 47/100
94/94 - 0s - loss: 0.0020 - 110ms/epoch - 1ms/step
Epoch 48/100
94/94 - 0s - loss: 0.0020 - 110ms/epoch - 1ms/step
Epoch 49/100
94/94 - 0s - loss: 0.0020 - 120ms/epoch - 1ms/step
Epoch 50/100
94/94 - 0s - loss: 0.0020 - 121ms/epoch - 1ms/step
Epoch 51/100
94/94 - 0s - loss: 0.0020 - 163ms/epoch - 2ms/step
Epoch 52/100
94/94 - 0s - loss: 0.0020 - 121ms/epoch - 1ms/step
Epoch 53/100
94/94 - 0s - loss: 0.0020 - 101ms/epoch - 1ms/step
Epoch 54/100
94/94 - 0s - loss: 0.0020 - 112ms/epoch - 1ms/step
Epoch 55/100
94/94 - 0s - loss: 0.0020 - 100ms/epoch - 1ms/step
Epoch 56/100
94/94 - 0s - loss: 0.0020 - 102ms/epoch - 1ms/step
Epoch 57/100
94/94 - 0s - loss: 0.0020 - 114ms/epoch - 1ms/step
Epoch 58/100
94/94 - 0s - loss: 0.0020 - 94ms/epoch - 1ms/step
Epoch 59/100
94/94 - 0s - loss: 0.0020 - 100ms/epoch - 1ms/step
Epoch 60/100
94/94 - 0s - loss: 0.0020 - 125ms/epoch - 1ms/step
Epoch 61/100
94/94 - 0s - loss: 0.0020 - 132ms/epoch - 1ms/step
Epoch 62/100
94/94 - 0s - loss: 0.0020 - 96ms/epoch - 1ms/step
Epoch 63/100
94/94 - 0s - loss: 0.0020 - 98ms/epoch - 1ms/step
Epoch 64/100
94/94 - 0s - loss: 0.0020 - 112ms/epoch - 1ms/step
Epoch 65/100
94/94 - 0s - loss: 0.0020 - 102ms/epoch - 1ms/step
Epoch 66/100
94/94 - 0s - loss: 0.0020 - 100ms/epoch - 1ms/step
Epoch 67/100
94/94 - 0s - loss: 0.0021 - 102ms/epoch - 1ms/step
Epoch 68/100
94/94 - 0s - loss: 0.0020 - 117ms/epoch - 1ms/step
Epoch 69/100
94/94 - 0s - loss: 0.0020 - 108ms/epoch - 1ms/step
Epoch 70/100
94/94 - 0s - loss: 0.0019 - 105ms/epoch - 1ms/step
Epoch 71/100
94/94 - 0s - loss: 0.0020 - 131ms/epoch - 1ms/step
Epoch 72/100
94/94 - 0s - loss: 0.0020 - 117ms/epoch - 1ms/step
Epoch 73/100
94/94 - 0s - loss: 0.0020 - 117ms/epoch - 1ms/step
Epoch 74/100
94/94 - 0s - loss: 0.0020 - 98ms/epoch - 1ms/step
Epoch 75/100
94/94 - 0s - loss: 0.0020 - 98ms/epoch - 1ms/step
Epoch 76/100
94/94 - 0s - loss: 0.0020 - 97ms/epoch - 1ms/step
Epoch 77/100
94/94 - 0s - loss: 0.0019 - 186ms/epoch - 2ms/step
Epoch 78/100
94/94 - 0s - loss: 0.0020 - 242ms/epoch - 3ms/step
Epoch 79/100
94/94 - 0s - loss: 0.0020 - 129ms/epoch - 1ms/step
Epoch 80/100
94/94 - 0s - loss: 0.0020 - 131ms/epoch - 1ms/step
Epoch 81/100
94/94 - 0s - loss: 0.0019 - 122ms/epoch - 1ms/step
Epoch 82/100
94/94 - 0s - loss: 0.0021 - 121ms/epoch - 1ms/step
Epoch 83/100
94/94 - 0s - loss: 0.0020 - 122ms/epoch - 1ms/step
Epoch 84/100
94/94 - 0s - loss: 0.0019 - 142ms/epoch - 2ms/step
Epoch 85/100
94/94 - 0s - loss: 0.0020 - 143ms/epoch - 2ms/step
Epoch 86/100
94/94 - 0s - loss: 0.0020 - 126ms/epoch - 1ms/step
Epoch 87/100
94/94 - 0s - loss: 0.0020 - 203ms/epoch - 2ms/step
Epoch 88/100
94/94 - 0s - loss: 0.0020 - 119ms/epoch - 1ms/step
Epoch 89/100
94/94 - 0s - loss: 0.0020 - 103ms/epoch - 1ms/step
Epoch 90/100
94/94 - 0s - loss: 0.0020 - 102ms/epoch - 1ms/step
Epoch 91/100
94/94 - 0s - loss: 0.0020 - 131ms/epoch - 1ms/step
Epoch 92/100
94/94 - 0s - loss: 0.0020 - 95ms/epoch - 1ms/step
Epoch 93/100
94/94 - 0s - loss: 0.0020 - 100ms/epoch - 1ms/step
Epoch 94/100
94/94 - 0s - loss: 0.0020 - 104ms/epoch - 1ms/step
Epoch 95/100
94/94 - 0s - loss: 0.0021 - 103ms/epoch - 1ms/step
Epoch 96/100
94/94 - 0s - loss: 0.0020 - 106ms/epoch - 1ms/step
Epoch 97/100
94/94 - 0s - loss: 0.0020 - 104ms/epoch - 1ms/step
Epoch 98/100
94/94 - 0s - loss: 0.0020 - 99ms/epoch - 1ms/step
Epoch 99/100
94/94 - 0s - loss: 0.0020 - 102ms/epoch - 1ms/step
Epoch 100/100
94/94 - 0s - loss: 0.0020 - 104ms/epoch - 1ms/step

1/3 [=========&gt;....................] - ETA: 0s
3/3 [==============================] - 0s 999us/step

1/2 [==============&gt;...............] - ETA: 0s
2/2 [==============================] - 0s 1ms/step
Keras weights file (&lt;HDF5 file &quot;variables.h5&quot; (mode r+)&gt;) saving:
...layers\dense
......vars
.........0
.........1
...layers\lstm
......vars
...layers\lstm\cell
......vars
.........0
.........1
.........2
...metrics\mean
......vars
.........0
.........1
...optimizer
......vars
.........0
.........1
.........10
.........2
.........3
.........4
.........5
.........6
.........7
.........8
.........9
...vars
Keras model archive saving:
File Name                                             Modified             Size
config.json                                    2025-10-14 14:13:58         1799
metadata.json                                  2025-10-14 14:13:58           64
variables.h5                                   2025-10-14 14:13:58        19408
Keras model archive loading:
File Name                                             Modified             Size
config.json                                    2025-10-14 14:13:58         1799
metadata.json                                  2025-10-14 14:13:58           64
variables.h5                                   2025-10-14 14:13:58        19408
Keras weights file (&lt;HDF5 file &quot;variables.h5&quot; (mode r)&gt;) loading:
...layers\dense
......vars
.........0
.........1
...layers\lstm
......vars
...layers\lstm\cell
......vars
.........0
.........1
.........2
...metrics\mean
......vars
.........0
.........1
...optimizer
......vars
.........0
.........1
.........10
.........2
.........3
.........4
.........5
.........6
.........7
.........8
.........9
...vars

1/2 [==============&gt;...............] - ETA: 0s
2/2 [==============================] - 0s 2ms/step
==&gt; [jsonpickle] Are test set predictions equal? True

1/2 [==============&gt;...............] - ETA: 0s
2/2 [==============================] - 0s 1ms/step
[[0.4021128 ]
 [0.37720966]
 [0.47297788]
 [0.45941365]
 [0.47128972]
 [0.5793639 ]
 [0.6429755 ]
 [0.6458207 ]
 [0.55137074]
 [0.45770863]
 [0.38435766]
 [0.43882015]
 [0.44571683]
 [0.4074061 ]
 [0.48306158]
 [0.45941365]
 [0.48473454]
 [0.59908426]
 [0.67917573]
 [0.6979623 ]
 [0.55137074]
 [0.4780294 ]
 [0.39325625]
 [0.44054735]
 [0.47970894]
 [0.44915324]
 [0.5545202 ]
 [0.5386771 ]
 [0.5762929 ]
 [0.6528898 ]
 [0.7526169 ]
 [0.76587296]
 [0.64011997]
 [0.5560912 ]
 [0.48306155]
 [0.5529466 ]
 [0.5716676 ]
 [0.5306661 ]
 [0.57475346]
 [0.63725454]
 [0.6528898 ]
 [0.7365729 ]
 [0.8363425 ]
 [0.8193032 ]
 [0.7019239 ]
 [0.63725454]]
==&gt; [manualtxt] Are test set predictions equal? True

&quot;\nimport sklearn_json as skljson\nskljson.to_json(new_scaler, &#39;./output/main01/test.json&#39;)\n\ndes_model = skljson.from_json(&#39;./output/main01/test.json&#39;)\nprint(des_model)\n&quot;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">  8</span> <span class="c1"># Libraries</span>
<span class="linenos">  9</span> <span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 10</span> <span class="kn">import</span> <span class="nn">pandas</span>
<span class="linenos"> 11</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 12</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="linenos"> 13</span> <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="linenos"> 14</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span> <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos"> 17</span> <span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="linenos"> 18</span> <span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="linenos"> 19</span> <span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">LSTM</span>
<span class="linenos"> 20</span> <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="linenos"> 21</span> <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span> <span class="c1"># fix random seed for reproducibility</span>
<span class="linenos"> 24</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span> <span class="c1"># ---------------------------------------------------</span>
<span class="linenos"> 27</span> <span class="c1"># Main example</span>
<span class="linenos"> 28</span> <span class="c1"># ---------------------------------------------------</span>
<span class="linenos"> 29</span> <span class="c1"># This is an example of training and LSM copied from</span>
<span class="linenos"> 30</span> <span class="c1"># the machine learning mastery blog. It is just to</span>
<span class="linenos"> 31</span> <span class="c1"># have a simple working model to work from.</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span> <span class="c1"># Path</span>
<span class="linenos"> 34</span> <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./data/passengers.csv&#39;</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span> <span class="c1"># Read data</span>
<span class="linenos"> 37</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
<span class="linenos"> 38</span>     <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span> <span class="c1"># Convert to numpy</span>
<span class="linenos"> 41</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span>
<span class="linenos"> 42</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span> <span class="c1"># normalize the dataset</span>
<span class="linenos"> 45</span> <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 46</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span> <span class="c1"># split into train and test sets</span>
<span class="linenos"> 49</span> <span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.67</span><span class="p">)</span>
<span class="linenos"> 50</span> <span class="n">test_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="n">train_size</span>
<span class="linenos"> 51</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">train_size</span><span class="p">,:],</span> <span class="n">dataset</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),:]</span>
<span class="linenos"> 52</span> <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span> <span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">look_back</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 55</span>     <span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="linenos"> 56</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">-</span><span class="n">look_back</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 57</span>         <span class="n">a</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="n">look_back</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 58</span>         <span class="n">dataX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos"> 59</span>         <span class="n">dataY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="linenos"> 60</span>     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataX</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataY</span><span class="p">)</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span> <span class="c1"># reshape into X=t and Y=t+1</span>
<span class="linenos"> 63</span> <span class="n">look_back</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 64</span> <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
<span class="linenos"> 65</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span> <span class="c1"># reshape input to be [samples, time steps, features]</span>
<span class="linenos"> 68</span> <span class="n">trainX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="p">(</span><span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">trainX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="linenos"> 69</span> <span class="n">testX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="p">(</span><span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">testX</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span> <span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span><span class="n">look_back</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 72</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
<span class="linenos"> 73</span>     <span class="c1"># create and fit the LSTM network</span>
<span class="linenos"> 74</span>     <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="linenos"> 75</span>     <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)))</span>
<span class="linenos"> 76</span>     <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 77</span>     <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>
<span class="linenos"> 78</span>     <span class="c1"># Return</span>
<span class="linenos"> 79</span>     <span class="k">return</span> <span class="n">model</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span> <span class="c1"># create and fit the LSTM network</span>
<span class="linenos"> 82</span> <span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">look_back</span><span class="p">)</span>
<span class="linenos"> 83</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span> <span class="n">trainPredict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">trainX</span><span class="p">)</span>
<span class="linenos"> 86</span> <span class="n">testPredict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 89</span><span class="sd"> # invert predictions</span>
<span class="linenos"> 90</span><span class="sd"> trainPredict = scaler.inverse_transform(trainPredict)</span>
<span class="linenos"> 91</span><span class="sd"> trainY = scaler.inverse_transform([trainY])</span>
<span class="linenos"> 92</span><span class="sd"> testPredict = scaler.inverse_transform(testPredict)</span>
<span class="linenos"> 93</span><span class="sd"> testY = scaler.inverse_transform([testY])</span>
<span class="linenos"> 94</span><span class="sd"> # calculate root mean squared error</span>
<span class="linenos"> 95</span><span class="sd"> trainScore = np.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))</span>
<span class="linenos"> 96</span><span class="sd"> print(&#39;Train Score: %.2f RMSE&#39; % (trainScore))</span>
<span class="linenos"> 97</span><span class="sd"> testScore = np.sqrt(mean_squared_error(testY[0], testPredict[:,0]))</span>
<span class="linenos"> 98</span><span class="sd"> print(&#39;Test Score: %.2f RMSE&#39; % (testScore))</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span><span class="sd"> # shift train predictions for plotting</span>
<span class="linenos">101</span><span class="sd"> trainPredictPlot = np.empty_like(dataset)</span>
<span class="linenos">102</span><span class="sd"> trainPredictPlot[:, :] = np.nan</span>
<span class="linenos">103</span><span class="sd"> trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict</span>
<span class="linenos">104</span><span class="sd"> # shift test predictions for plotting</span>
<span class="linenos">105</span><span class="sd"> testPredictPlot = np.empty_like(dataset)</span>
<span class="linenos">106</span><span class="sd"> testPredictPlot[:, :] = np.nan</span>
<span class="linenos">107</span><span class="sd"> testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict</span>
<span class="linenos">108</span><span class="sd"> # plot baseline and predictions</span>
<span class="linenos">109</span><span class="sd"> plt.plot(scaler.inverse_transform(dataset))</span>
<span class="linenos">110</span><span class="sd"> plt.plot(trainPredictPlot)</span>
<span class="linenos">111</span><span class="sd"> plt.plot(testPredictPlot)</span>
<span class="linenos">112</span><span class="sd"> #plt.show()</span>
<span class="linenos">113</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="linenos">114</span>
<span class="linenos">115</span>
<span class="linenos">116</span> <span class="c1"># ---------------------------------------</span>
<span class="linenos">117</span> <span class="c1"># Save and load</span>
<span class="linenos">118</span> <span class="c1"># ---------------------------------------</span>
<span class="linenos">119</span> <span class="c1"># Jsonpickle</span>
<span class="linenos">120</span> <span class="kn">import</span> <span class="nn">jsonpickle</span>
<span class="linenos">121</span> <span class="kn">import</span> <span class="nn">jsonpickle.ext.numpy</span> <span class="k">as</span> <span class="nn">jsonpickle_numpy</span>
<span class="linenos">122</span>
<span class="linenos">123</span> <span class="c1"># Configure jsonpickle</span>
<span class="linenos">124</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">set_preferred_backend</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<span class="linenos">125</span> <span class="n">jsonpickle_numpy</span><span class="o">.</span><span class="n">register_handlers</span><span class="p">()</span>
<span class="linenos">126</span>
<span class="linenos">127</span>
<span class="linenos">128</span> <span class="k">def</span> <span class="nf">to_jsonpickle</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="linenos">129</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
<span class="linenos">130</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">131</span>         <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">jsonpickle</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
<span class="linenos">132</span>
<span class="linenos">133</span>
<span class="linenos">134</span> <span class="k">def</span> <span class="nf">from_jsonpickle</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="linenos">135</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
<span class="linenos">136</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">137</span>         <span class="n">obj</span> <span class="o">=</span> <span class="n">jsonpickle</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="linenos">138</span>     <span class="k">return</span> <span class="n">obj</span>
<span class="linenos">139</span>
<span class="linenos">140</span>
<span class="linenos">141</span> <span class="k">def</span> <span class="nf">to_txt</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="linenos">142</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Converts a list of np.arrays to weights.</span>
<span class="linenos">143</span>
<span class="linenos">144</span><span class="sd">     .. note: The np.arrays must be 2D or less.</span>
<span class="linenos">145</span>
<span class="linenos">146</span><span class="sd">     Parameters</span>
<span class="linenos">147</span><span class="sd">     ----------</span>
<span class="linenos">148</span><span class="sd">     weights: list of np.arrays</span>
<span class="linenos">149</span><span class="sd">         The weights</span>
<span class="linenos">150</span><span class="sd">     path: str</span>
<span class="linenos">151</span><span class="sd">         The path to save the .txt files for each layer.</span>
<span class="linenos">152</span>
<span class="linenos">153</span><span class="sd">     Returns</span>
<span class="linenos">154</span><span class="sd">     --------</span>
<span class="linenos">155</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="linenos">156</span>     <span class="c1"># Libraries</span>
<span class="linenos">157</span>     <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">158</span>     <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos">159</span>
<span class="linenos">160</span>     <span class="c1"># Warning if more than 2D</span>
<span class="linenos">161</span>
<span class="linenos">162</span>     <span class="c1"># Save shapes</span>
<span class="linenos">163</span>     <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>
<span class="linenos">164</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s1">&#39;shapes.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">165</span>         <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">shapes</span><span class="p">))</span>
<span class="linenos">166</span>
<span class="linenos">167</span>     <span class="c1"># Save weights</span>
<span class="linenos">168</span>     <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
<span class="linenos">169</span>         <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;weights_layer_</span><span class="si">%s</span><span class="s1">.txt&#39;</span> <span class="o">%</span> <span class="n">i</span>
<span class="linenos">170</span>         <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="n">e</span> <span class="p">)</span> <span class="c1">#, fmt=&#39;%1.100e&#39;)</span>
<span class="linenos">171</span>
<span class="linenos">172</span> <span class="k">def</span> <span class="nf">from_txt</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="linenos">173</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Loads from a folder of txt files</span>
<span class="linenos">174</span>
<span class="linenos">175</span><span class="sd">     Parameters</span>
<span class="linenos">176</span><span class="sd">     ----------</span>
<span class="linenos">177</span><span class="sd">     path: str</span>
<span class="linenos">178</span><span class="sd">         The path with the .txt files for each layer.</span>
<span class="linenos">179</span>
<span class="linenos">180</span><span class="sd">     Returns</span>
<span class="linenos">181</span><span class="sd">     -------</span>
<span class="linenos">182</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="linenos">183</span>     <span class="kn">import</span> <span class="nn">glob</span>
<span class="linenos">184</span>     <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">185</span>     <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="linenos">186</span>
<span class="linenos">187</span>     <span class="c1"># Load shapes</span>
<span class="linenos">188</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s1">&#39;shapes.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">189</span>         <span class="n">shapes</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="linenos">190</span>
<span class="linenos">191</span>     <span class="c1"># Load weights</span>
<span class="linenos">192</span>     <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">193</span>     <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s1">&#39;weights_*&#39;</span><span class="p">)):</span>
<span class="linenos">194</span>         <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="linenos">195</span>
<span class="linenos">196</span>     <span class="c1"># Reshape</span>
<span class="linenos">197</span>     <span class="n">reshaped</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">198</span>     <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
<span class="linenos">199</span>         <span class="n">reshaped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
<span class="linenos">200</span>
<span class="linenos">201</span>     <span class="c1"># Return</span>
<span class="linenos">202</span>     <span class="k">return</span> <span class="n">reshaped</span>
<span class="linenos">203</span>
<span class="linenos">204</span>
<span class="linenos">205</span>
<span class="linenos">206</span>
<span class="linenos">207</span>
<span class="linenos">208</span>
<span class="linenos">209</span> <span class="c1"># ------------------------------------------------------------</span>
<span class="linenos">210</span> <span class="c1"># Example I: Serialization using jsonpickle</span>
<span class="linenos">211</span> <span class="c1"># ------------------------------------------------------------</span>
<span class="linenos">212</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Description:</span>
<span class="linenos">213</span>
<span class="linenos">214</span><span class="sd"> The purpose of this example is to demonstrate that by</span>
<span class="linenos">215</span><span class="sd"> employing jsonpickle, we can store and retrieve the model,</span>
<span class="linenos">216</span><span class="sd"> while ensuring that the predictions for the observations</span>
<span class="linenos">217</span><span class="sd"> remain unchanged.</span>
<span class="linenos">218</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="linenos">219</span>
<span class="linenos">220</span> <span class="c1"># Paths</span>
<span class="linenos">221</span> <span class="n">path_output_json_scaler</span> <span class="o">=</span> <span class="s1">&#39;./output/main01/scaler.json&#39;</span>
<span class="linenos">222</span> <span class="n">path_output_json_model</span> <span class="o">=</span> <span class="s1">&#39;./output/main01/model.json&#39;</span>
<span class="linenos">223</span>
<span class="linenos">224</span> <span class="c1"># Create path if it does not exist</span>
<span class="linenos">225</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_output_json_scaler</span><span class="p">)</span> \
<span class="linenos">226</span>     <span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">227</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_output_json_model</span><span class="p">)</span> \
<span class="linenos">228</span>     <span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">229</span>
<span class="linenos">230</span> <span class="c1"># Save</span>
<span class="linenos">231</span> <span class="n">to_jsonpickle</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="n">path_output_json_scaler</span><span class="p">)</span>
<span class="linenos">232</span> <span class="n">to_jsonpickle</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path_output_json_model</span><span class="p">)</span>
<span class="linenos">233</span>
<span class="linenos">234</span> <span class="c1"># Load model</span>
<span class="linenos">235</span> <span class="n">jsonpickle_scaler</span> <span class="o">=</span> <span class="n">from_jsonpickle</span><span class="p">(</span><span class="n">path_output_json_scaler</span><span class="p">)</span>
<span class="linenos">236</span> <span class="n">jsonpickle_model</span> <span class="o">=</span> <span class="n">from_jsonpickle</span><span class="p">(</span><span class="n">path_output_json_model</span><span class="p">)</span>
<span class="linenos">237</span>
<span class="linenos">238</span> <span class="c1"># Predict</span>
<span class="linenos">239</span> <span class="n">jsonpickle_model_pred_test</span> <span class="o">=</span> <span class="n">jsonpickle_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
<span class="linenos">240</span>
<span class="linenos">241</span> <span class="c1"># Are the predictions equal?</span>
<span class="linenos">242</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==&gt; [jsonpickle] Are test set predictions equal? </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<span class="linenos">243</span>     <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">testPredict</span><span class="p">,</span> <span class="n">jsonpickle_model_pred_test</span><span class="p">))</span>
<span class="linenos">244</span>
<span class="linenos">245</span>
<span class="linenos">246</span>
<span class="linenos">247</span>
<span class="linenos">248</span>
<span class="linenos">249</span> <span class="c1"># ------------------------------------------------------------</span>
<span class="linenos">250</span> <span class="c1"># Example II: Serialization using readable txt</span>
<span class="linenos">251</span> <span class="c1"># ------------------------------------------------------------</span>
<span class="linenos">252</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Description:</span>
<span class="linenos">253</span>
<span class="linenos">254</span><span class="sd"> The purpose of this example is to demonstrate that by</span>
<span class="linenos">255</span><span class="sd"> employing a manual approach with readable txt files, we</span>
<span class="linenos">256</span><span class="sd"> can store and retrieve the model, while ensuring that</span>
<span class="linenos">257</span><span class="sd"> the predictions for the observations remain unchanged.</span>
<span class="linenos">258</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="linenos">259</span>
<span class="linenos">260</span> <span class="c1"># Define path</span>
<span class="linenos">261</span> <span class="n">path_output_txt</span> <span class="o">=</span> <span class="s1">&#39;./output/main01/txt&#39;</span>
<span class="linenos">262</span>
<span class="linenos">263</span> <span class="c1"># Create path if it does not exist</span>
<span class="linenos">264</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_output_txt</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">265</span>
<span class="linenos">266</span> <span class="c1"># Get weights from model</span>
<span class="linenos">267</span> <span class="n">w</span> <span class="o">=</span> <span class="n">jsonpickle_model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>
<span class="linenos">268</span>
<span class="linenos">269</span> <span class="c1"># Save to txt</span>
<span class="linenos">270</span> <span class="n">to_txt</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path_output_txt</span><span class="p">)</span>
<span class="linenos">271</span>
<span class="linenos">272</span> <span class="c1"># Load from txt</span>
<span class="linenos">273</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">from_txt</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path_output_txt</span><span class="p">)</span>
<span class="linenos">274</span>
<span class="linenos">275</span> <span class="c1"># Compare</span>
<span class="linenos">276</span> <span class="c1">#for w1, a1 in zip(w, weights):</span>
<span class="linenos">277</span> <span class="c1">#    print(np.array_equal(w1, a1))</span>
<span class="linenos">278</span>
<span class="linenos">279</span> <span class="c1"># Create model again from txt weights</span>
<span class="linenos">280</span> <span class="n">txt_model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">look_back</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">281</span> <span class="n">txt_model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="linenos">282</span> <span class="n">txt_model_pred_test</span> <span class="o">=</span> <span class="n">txt_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testX</span><span class="p">)</span>
<span class="linenos">283</span>
<span class="linenos">284</span> <span class="nb">print</span><span class="p">(</span><span class="n">txt_model_pred_test</span><span class="p">)</span>
<span class="linenos">285</span>
<span class="linenos">286</span> <span class="c1"># Are the predictions equal?</span>
<span class="linenos">287</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==&gt; [manualtxt] Are test set predictions equal? </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<span class="linenos">288</span>     <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">testPredict</span><span class="p">,</span> <span class="n">txt_model_pred_test</span><span class="p">))</span>
<span class="linenos">289</span>
<span class="linenos">290</span>
<span class="linenos">291</span>
<span class="linenos">292</span> <span class="c1"># ---------------------------------------</span>
<span class="linenos">293</span> <span class="c1"># Example III: Using skljson</span>
<span class="linenos">294</span> <span class="c1"># ---------------------------------------</span>
<span class="linenos">295</span> <span class="c1"># It seems that it does not work for the scalers, only for a handful</span>
<span class="linenos">296</span> <span class="c1"># of models so might need to do it manually too.</span>
<span class="linenos">297</span>
<span class="linenos">298</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">299</span><span class="sd"> import sklearn_json as skljson</span>
<span class="linenos">300</span><span class="sd"> skljson.to_json(new_scaler, &#39;./output/main01/test.json&#39;)</span>
<span class="linenos">301</span>
<span class="linenos">302</span><span class="sd"> des_model = skljson.from_json(&#39;./output/main01/test.json&#39;)</span>
<span class="linenos">303</span><span class="sd"> print(des_model)</span>
<span class="linenos">304</span><span class="sd"> &quot;&quot;&quot;</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  17.828 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-tensorflow-plot-main-01-keras-lstm-mlm-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/be5c8ea68a94eff2400d2313fc66a026/plot_main_01_keras_lstm_mlm.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_main_01_keras_lstm_mlm.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/70023c3f03940a3c10427b033b560fda/plot_main_01_keras_lstm_mlm.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_main_01_keras_lstm_mlm.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gunn_review_keras.html" class="btn btn-neutral float-left" title="Main" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tpot/main01.html" class="btn btn-neutral float-right" title="01. Basic example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2025, Bernard Hernandez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>