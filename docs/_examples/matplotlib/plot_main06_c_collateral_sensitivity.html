<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>06.c Collateral Sensitivity Index (CRI) &mdash; python-spare-code 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/python_icon_191765.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="06.d Collateral Sensitivity Index (CRI)" href="plot_main06_d_collateral_sensitivity.html" />
    <link rel="prev" title="06.b sns.heatmap for CRI v2" href="plot_main06_b_heatmap.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            python-spare-code
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">General</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#explainer-dashboard">Explainer Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#factory-boy">Factory Boy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#jsonpickle">jsonpickle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ldap">LDAP</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#matplotlib-seaborn">Matplotlib / Seaborn</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_main01_imshow.html">01. 2D array with <code class="docutils literal notranslate"><span class="pre">mpl.imshow</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main02_hexbin.html">02. Point density with <code class="docutils literal notranslate"><span class="pre">matplotlib.hexbin</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main03_hist2d.html">03. 2D histograms and density plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main04_gmm_kde.html">0.4 Visualizing GMM and KDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05_a_clustermap.html">05.a <code class="docutils literal notranslate"><span class="pre">sns.clustermap</span></code> basic sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05_b_clustermap.html">05.b <code class="docutils literal notranslate"><span class="pre">sns.clustermap</span></code> with <code class="docutils literal notranslate"><span class="pre">network.csv</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05_c_clustermap.html">05.c <code class="docutils literal notranslate"><span class="pre">sns.clustermap</span></code> multiple categories</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main06_a_heatmap.html">06.a <code class="docutils literal notranslate"><span class="pre">sns.heatmap</span></code> for CRI <code class="docutils literal notranslate"><span class="pre">v1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main06_b_heatmap.html">06.b <code class="docutils literal notranslate"><span class="pre">sns.heatmap</span></code> for CRI <code class="docutils literal notranslate"><span class="pre">v2</span></code></a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">06.c Collateral Sensitivity Index (CRI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main06_d_collateral_sensitivity.html">06.d Collateral Sensitivity Index (CRI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main07_a_2dbin_stat.html">07.a <code class="docutils literal notranslate"><span class="pre">stats.2dbin</span></code> and <code class="docutils literal notranslate"><span class="pre">mpl.heatmap</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main07_b_2dbin_heatmap.html">07.b <code class="docutils literal notranslate"><span class="pre">stats.2dbin</span></code> and <code class="docutils literal notranslate"><span class="pre">sns.heatmap</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main07_c_2dbin_fake.html">07.c <code class="docutils literal notranslate"><span class="pre">stats.2dbin</span></code> with fake data</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main07_d_2dbin_shap.html">07.d <code class="docutils literal notranslate"><span class="pre">stats.2dbin</span></code> with <code class="docutils literal notranslate"><span class="pre">shap.csv</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main07_e_displot.html">07.e 3D Data with <code class="docutils literal notranslate"><span class="pre">sns.displot</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main08_table.html">08. Stacked bar chart with data table</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main09_tripcolor.html">09. Triangular grids with <code class="docutils literal notranslate"><span class="pre">mpl.tripcolor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main10_violin_cmap.html">10. Violin plot with linear colormap</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main20_animation.html">20. Basic animation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main30_boxplot_sepsis_shap.html">11. Visualizing SHAP across timesteps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#other">Other</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#pandas">Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plotly">Plotly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#scikits">Scikits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#shap">Shap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tableone">TableOne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tensorflow">Tensorflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ukvi-trips">UKVI Trips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#utils">Utils</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">python-spare-code</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">General</a></li>
      <li class="breadcrumb-item active">06.c Collateral Sensitivity Index (CRI)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/_examples/matplotlib/plot_main06_c_collateral_sensitivity.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-matplotlib-plot-main06-c-collateral-sensitivity-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="c-collateral-sensitivity-index-cri">
<span id="sphx-glr-examples-matplotlib-plot-main06-c-collateral-sensitivity-py"></span><h1>06.c Collateral Sensitivity Index (CRI)<a class="headerlink" href="#c-collateral-sensitivity-index-cri" title="Permalink to this heading"></a></h1>
<p>This script creates a sophisticated, multi-panel visualization
for pre-computed Collateral Sensitivity Index (CRI) data, designed
for in-depth analysis of drug interactions.</p>
<p>The workflow includes:</p>
<blockquote>
<div><ul class="simple">
<li><p>Data Loading: It ingests pre-processed CRI and sample
frequency data from CSV files.</p></li>
<li><p>Multi-Heatmap Layout: It generates several <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> heatmaps:
one for the CRI (using a diverging colormap), another for
sample counts (with a log scale), and a composite heatmap
combining both metrics in its upper and lower triangles.</p></li>
<li><p>Categorical Annotation: It enhances the final plot by adding
color-coded labels to the axes based on antibiotic categories,
creating a dense, information-rich figure.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the computation of the Collateral Sensitivity Index is quite
computationally expensive, the results are saved into a .csv file
so that can be easily loaded and displayed. This script shows a
very basic graph of such information.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">27</span> <span class="c1"># Libraries</span>
<span class="linenos">28</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">29</span> <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="linenos">30</span> <span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="linenos">31</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="linenos">32</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="linenos">33</span>
<span class="linenos">34</span> <span class="c1">#</span>
<span class="linenos">35</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">36</span> <span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>
<span class="linenos">37</span> <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogNorm</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="linenos">38</span>
<span class="linenos">39</span> <span class="c1"># See https://matplotlib.org/devdocs/users/explain/customizing.html</span>
<span class="linenos">40</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="linenos">41</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="linenos">42</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="linenos">43</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="linenos">44</span>
<span class="linenos">45</span> <span class="k">try</span><span class="p">:</span>
<span class="linenos">46</span>     <span class="vm">__file__</span>
<span class="linenos">47</span>     <span class="n">TERMINAL</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">48</span> <span class="k">except</span><span class="p">:</span>
<span class="linenos">49</span>     <span class="n">TERMINAL</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">50</span>
<span class="linenos">51</span>
<span class="linenos">52</span> <span class="c1"># --------------------------------</span>
<span class="linenos">53</span> <span class="c1"># Methods</span>
<span class="linenos">54</span> <span class="c1"># --------------------------------</span>
<span class="linenos">55</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_ax_ay_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">):</span>
<span class="linenos">56</span>     <span class="k">return</span> <span class="n">ax</span><span class="o">==</span><span class="n">ay</span>
<span class="linenos">57</span>
<span class="linenos">58</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_ax_ay_greater</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">):</span>
<span class="linenos">59</span>     <span class="k">return</span>  <span class="n">ax</span><span class="o">&gt;</span><span class="n">ay</span>
<span class="linenos">60</span>
<span class="linenos">61</span> <span class="c1"># --------------------------------</span>
<span class="linenos">62</span> <span class="c1"># Constants</span>
<span class="linenos">63</span> <span class="c1"># --------------------------------</span>
<span class="linenos">64</span> <span class="c1"># Possible cmaps</span>
<span class="linenos">65</span> <span class="c1"># https://r02b.github.io/seaborn_palettes/</span>
<span class="linenos">66</span> <span class="c1"># Diverging: coolwarm, RdBu_r, vlag</span>
<span class="linenos">67</span> <span class="c1"># Others: bone, gray, pink, twilight</span>
<span class="linenos">68</span> <span class="n">cmap0</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span>
<span class="linenos">69</span> <span class="n">cmap1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s2">&quot;seagreen&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">70</span> <span class="n">cmap2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;light:b&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">71</span> <span class="n">cmap3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;vlag&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">72</span> <span class="n">cmap4</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">73</span> <span class="n">cmap5</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;ch:s=.25,rot=-.25&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># no</span>
<span class="linenos">74</span> <span class="n">cmap6</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;light:#5A9&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">75</span> <span class="n">cmap7</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s2">&quot;#9dedcc&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">76</span> <span class="n">cmap8</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;YlGn&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">77</span>
<span class="linenos">78</span> <span class="c1"># Figure size</span>
<span class="linenos">79</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s load the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 85</span> <span class="c1"># Load data</span>
<span class="linenos"> 86</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../datasets/collateral-sensitivity/20230525-135511&#39;</span><span class="p">)</span>
<span class="linenos"> 87</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s1">&#39;contingency.csv&#39;</span><span class="p">)</span>
<span class="linenos"> 88</span> <span class="n">abxs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s1">&#39;categories.csv&#39;</span><span class="p">)</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span> <span class="c1"># Format data</span>
<span class="linenos"> 91</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="s1">&#39;ay&#39;</span><span class="p">])</span>
<span class="linenos"> 92</span> <span class="n">data</span><span class="o">.</span><span class="n">RR</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 93</span> <span class="n">data</span><span class="o">.</span><span class="n">RS</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">RS</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 94</span> <span class="n">data</span><span class="o">.</span><span class="n">SR</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">SR</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 95</span> <span class="n">data</span><span class="o">.</span><span class="n">SS</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">SS</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 96</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">RR</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">RS</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">SR</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">SS</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span> <span class="c1">#data[&#39;samples&#39;] = data.iloc[:, :4].sum(axis=1)</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span> <span class="k">def</span><span class="w"> </span><span class="nf">filter_top_pairs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="linenos">101</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Filter top n (Specimen, Organism) pairs.&quot;&quot;&quot;</span>
<span class="linenos">102</span>     <span class="c1"># Find top</span>
<span class="linenos">103</span>     <span class="n">top</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> \
<span class="linenos">104</span>         <span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> \
<span class="linenos">105</span>         <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
<span class="linenos">106</span>         <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="linenos">107</span>
<span class="linenos">108</span>     <span class="c1"># Filter</span>
<span class="linenos">109</span>     <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
<span class="linenos">110</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="linenos">111</span>     <span class="n">b</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="linenos">112</span>
<span class="linenos">113</span>     <span class="c1"># Return</span>
<span class="linenos">114</span>     <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]]</span>
<span class="linenos">115</span>
<span class="linenos">116</span> <span class="c1"># Filter</span>
<span class="linenos">117</span> <span class="n">data</span> <span class="o">=</span> <span class="n">filter_top_pairs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">118</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">samples</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">]</span>
</pre></div>
</div>
<p>Lets see the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">122</span> <span class="k">if</span> <span class="n">TERMINAL</span><span class="p">:</span>
<span class="linenos">123</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">124</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of samples: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="linenos">125</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of pairs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos">126</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data:&quot;</span><span class="p">)</span>
<span class="linenos">127</span>     <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="linenos">128</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">7</span><span class="p">,:]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>RR</th>
      <th>RS</th>
      <th>SI</th>
      <th>SR</th>
      <th>SS</th>
      <th>MIS</th>
      <th>samples</th>
    </tr>
    <tr>
      <th>specimen</th>
      <th>o</th>
      <th>ax</th>
      <th>ay</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="7" valign="top">WOUCUL</th>
      <th rowspan="7" valign="top">SAUR</th>
      <th rowspan="7" valign="top">ACHL</th>
      <th>ACLI</th>
      <td>2</td>
      <td>10</td>
      <td>3.0</td>
      <td>165</td>
      <td>585</td>
      <td>-0.003227</td>
      <td>762</td>
    </tr>
    <tr>
      <th>AERY</th>
      <td>2</td>
      <td>10</td>
      <td>4.0</td>
      <td>213</td>
      <td>536</td>
      <td>-0.007012</td>
      <td>761</td>
    </tr>
    <tr>
      <th>AFUS</th>
      <td>2</td>
      <td>10</td>
      <td>NaN</td>
      <td>86</td>
      <td>667</td>
      <td>0.003373</td>
      <td>765</td>
    </tr>
    <tr>
      <th>ALIN</th>
      <td>0</td>
      <td>10</td>
      <td>NaN</td>
      <td>0</td>
      <td>523</td>
      <td>0.000000</td>
      <td>533</td>
    </tr>
    <tr>
      <th>AMET</th>
      <td>3</td>
      <td>9</td>
      <td>NaN</td>
      <td>71</td>
      <td>679</td>
      <td>0.010702</td>
      <td>762</td>
    </tr>
    <tr>
      <th>AMUP</th>
      <td>0</td>
      <td>10</td>
      <td>6.0</td>
      <td>3</td>
      <td>690</td>
      <td>-0.000183</td>
      <td>703</td>
    </tr>
    <tr>
      <th>ANEO</th>
      <td>1</td>
      <td>9</td>
      <td>NaN</td>
      <td>27</td>
      <td>622</td>
      <td>0.003881</td>
      <td>659</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Lets load the antimicrobial data and create color mapping variables</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">134</span> <span class="c1"># Create dictionary to map category to color</span>
<span class="linenos">135</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">abxs</span><span class="o">.</span><span class="n">category</span>
<span class="linenos">136</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;Spectral&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span>
<span class="linenos">137</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span>
<span class="linenos">138</span>     <span class="n">light</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">dark</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rot</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">139</span> <span class="n">lookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">palette</span><span class="p">))</span>
<span class="linenos">140</span>
<span class="linenos">141</span> <span class="c1"># Create dictionary to map code to category</span>
<span class="linenos">142</span> <span class="n">code2cat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">abxs</span><span class="o">.</span><span class="n">antimicrobial_code</span><span class="p">,</span> <span class="n">abxs</span><span class="o">.</span><span class="n">category</span><span class="p">))</span>
</pre></div>
</div>
<p>Let’s display the information</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">148</span> <span class="c1"># Loop</span>
<span class="linenos">149</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
<span class="linenos">150</span>
<span class="linenos">151</span>     <span class="c1"># Drop level</span>
<span class="linenos">152</span>     <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="linenos">153</span>
<span class="linenos">154</span>     <span class="c1"># Check possible issues.</span>
<span class="linenos">155</span>     <span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">156</span>     <span class="n">ay</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">157</span>     <span class="n">idx1</span> <span class="o">=</span> <span class="n">_check_ax_ay_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">)</span>
<span class="linenos">158</span>     <span class="n">idx2</span> <span class="o">=</span> <span class="n">_check_ax_ay_greater</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">)</span>
<span class="linenos">159</span>
<span class="linenos">160</span>     <span class="c1"># Show</span>
<span class="linenos">161</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%25s</span><span class="s2">. ax==ay =&gt; </span><span class="si">%5s</span><span class="s2"> | ax&gt;ay =&gt; </span><span class="si">%5s</span><span class="s2">&quot;</span> <span class="o">%</span> \
<span class="linenos">162</span>           <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">idx1</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">idx2</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<span class="linenos">163</span>
<span class="linenos">164</span>     <span class="c1"># Re-index to have square matrix</span>
<span class="linenos">165</span>     <span class="n">abxs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ay</span><span class="p">)</span>
<span class="linenos">166</span>     <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">abxs</span><span class="p">,</span> <span class="n">abxs</span><span class="p">])</span>
<span class="linenos">167</span>
<span class="linenos">168</span>     <span class="c1"># Reformat MIS</span>
<span class="linenos">169</span>     <span class="n">mis</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MIS&#39;</span><span class="p">]</span> \
<span class="linenos">170</span>         <span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> \
<span class="linenos">171</span>         <span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="linenos">172</span>
<span class="linenos">173</span>     <span class="c1"># Reformat samples</span>
<span class="linenos">174</span>     <span class="n">freq</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span> \
<span class="linenos">175</span>         <span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> \
<span class="linenos">176</span>         <span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="linenos">177</span>
<span class="linenos">178</span>     <span class="c1"># Combine in square matrix</span>
<span class="linenos">179</span>     <span class="n">m1</span> <span class="o">=</span> <span class="n">mis</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="linenos">180</span>     <span class="n">m2</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="linenos">181</span>     <span class="n">il1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril_indices</span><span class="p">(</span><span class="n">mis</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">182</span>     <span class="n">m1</span><span class="p">[</span><span class="n">il1</span><span class="p">]</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">il1</span><span class="p">]</span>
<span class="linenos">183</span>     <span class="n">m</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span>
<span class="linenos">184</span>         <span class="n">index</span><span class="o">=</span><span class="n">mis</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">mis</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="linenos">185</span>
<span class="linenos">186</span>     <span class="c1"># .. note: This is the matrix that is used in previous</span>
<span class="linenos">187</span>     <span class="c1">#          samples to display the CRI and the count using</span>
<span class="linenos">188</span>     <span class="c1">#          the sns.heatmap function</span>
<span class="linenos">189</span>     <span class="c1"># Save</span>
<span class="linenos">190</span>     <span class="c1">#m.to_csv(&#39;%s&#39;%str(i))</span>
<span class="linenos">191</span>
<span class="linenos">192</span>     <span class="c1"># Add frequency</span>
<span class="linenos">193</span>     <span class="n">top_n</span> <span class="o">=</span> <span class="n">df</span> \
<span class="linenos">194</span>         <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;samples&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
<span class="linenos">195</span>         <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;MIS&#39;</span><span class="p">)</span> \
<span class="linenos">196</span>         <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="linenos">197</span>
<span class="linenos">198</span>     <span class="c1"># Draw</span>
<span class="linenos">199</span>     <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="linenos">200</span>         <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
<span class="linenos">201</span>         <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]})</span>
<span class="linenos">202</span>
<span class="linenos">203</span>     <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mis</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
<span class="linenos">204</span>                 <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">70</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="linenos">205</span>                 <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">206</span>                 <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">207</span>
<span class="linenos">208</span>     <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
<span class="linenos">209</span>                 <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span>
<span class="linenos">210</span>                 <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">211</span>                 <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">212</span>
<span class="linenos">213</span>     <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">top_n</span><span class="p">,</span>
<span class="linenos">214</span>                 <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="linenos">215</span>                 <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">216</span>                 <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">217</span>                 <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">218</span>                 <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">219</span>                     <span class="s1">&#39;use_gridspec&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="linenos">220</span>                     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;right&#39;</span>
<span class="linenos">221</span>                 <span class="p">}</span>
<span class="linenos">222</span>     <span class="p">)</span>
<span class="linenos">223</span>
<span class="linenos">224</span>     <span class="c1"># Display</span>
<span class="linenos">225</span>     <span class="n">masku</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="linenos">226</span>     <span class="n">maskl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="linenos">227</span>     <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap8</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">masku</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<span class="linenos">228</span>                 <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span>
<span class="linenos">229</span>                 <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">230</span>     <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap4</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">maskl</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<span class="linenos">231</span>                 <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<span class="linenos">232</span>                 <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">233</span>                 <span class="n">xticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">234</span>
<span class="linenos">235</span>     <span class="c1"># Configure axes</span>
<span class="linenos">236</span>     <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Contingency&#39;</span><span class="p">)</span>
<span class="linenos">237</span>     <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of samples&#39;</span><span class="p">)</span>
<span class="linenos">238</span>     <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Collateral Sensitivity Index&#39;</span><span class="p">)</span>
<span class="linenos">239</span>     <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Samples / Collateral Sensitivity&#39;</span><span class="p">)</span>
<span class="linenos">240</span>
<span class="linenos">241</span>     <span class="c1"># Add colors to xticklabels</span>
<span class="linenos">242</span>
<span class="linenos">243</span>     <span class="c1">#abxs = pd.read_csv(&#39;../../datasets/susceptibility-nhs/susceptibility-v0.0.1/antimicrobials.csv&#39;)##</span>
<span class="linenos">244</span>
<span class="linenos">245</span>     <span class="c1">#groups = dict(zip(abxs.antimicrobial_code, abxs.category))</span>
<span class="linenos">246</span>     <span class="c1">#cmap = sns.color_palette(&quot;Spectral&quot;, abxs.category.nunique())</span>
<span class="linenos">247</span>     <span class="c1">#colors = dict(zip(abxs.category, cmap))</span>
<span class="linenos">248</span>
<span class="linenos">249</span>     <span class="c1"># ------------------------------------------</span>
<span class="linenos">250</span>     <span class="c1"># Add category colors on xtick labels</span>
<span class="linenos">251</span>     <span class="c1"># ------------------------------------------</span>
<span class="linenos">252</span>     <span class="c1"># Create colors</span>
<span class="linenos">253</span>     <span class="n">colors</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">code2cat</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">lookup</span><span class="p">)</span>
<span class="linenos">254</span>
<span class="linenos">255</span>     <span class="c1"># Loop</span>
<span class="linenos">256</span>     <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
<span class="linenos">257</span>         <span class="k">try</span><span class="p">:</span>
<span class="linenos">258</span>             <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
<span class="linenos">259</span>             <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lbl</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="linenos">260</span>             <span class="n">lbl</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="linenos">261</span>             <span class="n">lbl</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="linenos">262</span>
<span class="linenos">263</span><span class="w">             </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">264</span><span class="sd">             axs[3].annotate(&#39;&#39;, xy=(2000, 0),</span>
<span class="linenos">265</span><span class="sd">                 #xytext=(0, -15 - axs[3].xaxis.labelpad),</span>
<span class="linenos">266</span><span class="sd">                 xytext=(i.x, y)</span>
<span class="linenos">267</span><span class="sd">                 xycoords=(&#39;data&#39;, &#39;axes fraction&#39;),</span>
<span class="linenos">268</span><span class="sd">                 textcoords=&#39;offset points&#39;,</span>
<span class="linenos">269</span><span class="sd">                 ha=&#39;center&#39;, va=&#39;top&#39;,</span>
<span class="linenos">270</span><span class="sd">                 bbox=dict(boxstyle=&#39;round&#39;, fc=&#39;none&#39;, ec=&#39;red&#39;))</span>
<span class="linenos">271</span><span class="sd">             &quot;&quot;&quot;</span>
<span class="linenos">272</span>         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">273</span>             <span class="nb">print</span><span class="p">(</span><span class="n">lbl</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span> <span class="n">e</span><span class="p">)</span>
<span class="linenos">274</span>
<span class="linenos">275</span>     <span class="c1"># Configure plot</span>
<span class="linenos">276</span>     <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="linenos">277</span>     <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="linenos">278</span>     <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">279</span>
<span class="linenos">280</span>     <span class="c1"># Exit loop</span>
<span class="linenos">281</span>     <span class="k">break</span>
<span class="linenos">282</span>
<span class="linenos">283</span> <span class="c1"># Show</span>
<span class="linenos">284</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_main06_c_collateral_sensitivity_001.png" srcset="../../_images/sphx_glr_plot_main06_c_collateral_sensitivity_001.png" alt="URICUL - ECOL, Contingency, Number of samples, Collateral Sensitivity Index, Samples / Collateral Sensitivity" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>       (&#39;URICUL&#39;, &#39;ECOL&#39;). ax==ay =&gt;    18 | ax&gt;ay =&gt;     0
C:\Users\kelda\Desktop\repositories\github\python-spare-code\main\examples\matplotlib\plot_main06_c_collateral_sensitivity.py:284: UserWarning:

FigureCanvasAgg is non-interactive, and thus cannot be shown
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  3.236 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-matplotlib-plot-main06-c-collateral-sensitivity-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/aa3f40480cbae9d72a623ad02d720ba7/plot_main06_c_collateral_sensitivity.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_main06_c_collateral_sensitivity.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/4e7bf233dbea46dd2655c08bc2a53d7e/plot_main06_c_collateral_sensitivity.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_main06_c_collateral_sensitivity.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_main06_b_heatmap.html" class="btn btn-neutral float-left" title="06.b sns.heatmap for CRI v2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plot_main06_d_collateral_sensitivity.html" class="btn btn-neutral float-right" title="06.d Collateral Sensitivity Index (CRI)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2025, Bernard Hernandez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>