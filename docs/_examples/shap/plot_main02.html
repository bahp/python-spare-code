<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>02. Explainers Across ML Classifiers &mdash; python-spare-code 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/python_icon_191765.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="04. Basic example" href="plot_main04.html" />
    <link rel="prev" title="01. A practical example" href="plot_main01.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            python-spare-code
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">General</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#explainer-dashboard">Explainer Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#factory-boy">Factory Boy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#jsonpickle">jsonpickle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ldap">LDAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#matplotlib-seaborn">Matplotlib / Seaborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#other">Other</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#pandas">Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#plotly">Plotly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#scikits">Scikits</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#shap">Shap</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_main01.html">01. A practical example</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">02. Explainers Across ML Classifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main04.html">04. Basic example</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05.html">05. Display SHAP for Sequential Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05_stripplot.html">05a. Custom using stripplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05_summaryplot.html">05b. Custom using summary_plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main05_swarmplot.html">05c. Custom using swarmplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main07.html">07. SHAP Beeswarm Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_main08.html">08. Basic example</a></li>
<li class="toctree-l3"><a class="reference internal" href="temp.html">06. Basic example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tableone">TableOne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tensorflow">Tensorflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#ukvi-trips">UKVI Trips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#utils">Utils</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">python-spare-code</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">General</a></li>
      <li class="breadcrumb-item active">02. Explainers Across ML Classifiers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/_examples/shap/plot_main02.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-shap-plot-main02-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="explainers-across-ml-classifiers">
<span id="sphx-glr-examples-shap-plot-main02-py"></span><h1>02. Explainers Across ML Classifiers<a class="headerlink" href="#explainers-across-ml-classifiers" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>This script serves as a practical guide to applying the SHAP
library across a diverse set of machine learning algorithms.
It highlights a critical concept in model interpretability:
different model architectures require specific types of SHAP
explainers for accurate and efficient computation. ü§ñ</p>
<p>The workflow includes:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Training Various Models:</strong> A suite of classifiers from scikit-learn
and XGBoost are trained, including LogisticRegression, RandomForestClassifier,
SVC, and XGBClassifier.</p></li>
<li><p><strong>Applying Appropriate Explainers:</strong> The script demonstrates how to select
and use different explainers, primarily contrasting the model-agnostic
shap.KernelExplainer with the highly optimized explainer for tree-based
models.</p></li>
<li><p><strong>Visual Comparison:</strong> For each classifier, a SHAP summary plot is generated,
allowing for a side-by-side comparison of feature importances as interpreted
by each model.</p></li>
</ul>
</div></blockquote>
<p>This example is invaluable for understanding the practical nuances
of using SHAP and for choosing the correct approach to explain the
predictions of your specific machine learning model.</p>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_plot_main02_001.png" srcset="../../_images/sphx_glr_plot_main02_001.png" alt="GaussianNB" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_002.png" srcset="../../_images/sphx_glr_plot_main02_002.png" alt="LogisticRegression" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_003.png" srcset="../../_images/sphx_glr_plot_main02_003.png" alt="DecisionTreeClassifier" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_004.png" srcset="../../_images/sphx_glr_plot_main02_004.png" alt="RandomForestClassifier" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_005.png" srcset="../../_images/sphx_glr_plot_main02_005.png" alt="XGBClassifier" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_006.png" srcset="../../_images/sphx_glr_plot_main02_006.png" alt="MLPClassifier" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_007.png" srcset="../../_images/sphx_glr_plot_main02_007.png" alt="SVC" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_main02_008.png" srcset="../../_images/sphx_glr_plot_main02_008.png" alt="ExtraTreesClassifier" class = "sphx-glr-multi-img"/></li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>C:\Users\kelda\Desktop\repositories\virtualenvs\venv-py311-psc\Lib\site-packages\sklearn\neural_network\_multilayer_perceptron.py:781: ConvergenceWarning:

Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn&#39;t converged yet.

&lt;IPython.core.display.HTML object&gt;

--------------------------------------------------------------------------------
Classifier: GaussianNB()
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  5%|######4                                                                                                                  | 20/375 [00:00&lt;00:01, 196.94it/s]
 13%|###############1                                                                                                         | 47/375 [00:00&lt;00:01, 230.93it/s]
 22%|##########################1                                                                                              | 81/375 [00:00&lt;00:01, 278.80it/s]
 34%|########################################9                                                                               | 128/375 [00:00&lt;00:00, 352.92it/s]
 49%|##########################################################5                                                             | 183/375 [00:00&lt;00:00, 423.14it/s]
 63%|############################################################################1                                           | 238/375 [00:00&lt;00:00, 464.40it/s]
 78%|##############################################################################################                          | 294/375 [00:00&lt;00:00, 493.48it/s]
 93%|################################################################################################################        | 350/375 [00:00&lt;00:00, 512.56it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 437.46it/s]
[[-0.22973754 -0.19940695 -0.235981  ]
 [ 0.13623621  0.04200439  0.15531092]
 [-0.33313712  0.05794303 -0.32997588]
 ...
 [-0.11342721  0.05598801 -0.15242103]
 [ 0.13523148  0.01406085  0.14369843]
 [-0.21293465  0.14266244 -0.26182637]]
base value: 0.6651264808594763

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 15%|##################3                                                                                                      | 57/375 [00:00&lt;00:00, 569.20it/s]
 31%|####################################8                                                                                   | 115/375 [00:00&lt;00:00, 572.19it/s]
 46%|#######################################################3                                                                | 173/375 [00:00&lt;00:00, 565.40it/s]
 61%|#########################################################################6                                              | 230/375 [00:00&lt;00:00, 557.54it/s]
 76%|###########################################################################################5                            | 286/375 [00:00&lt;00:00, 554.49it/s]
 91%|#############################################################################################################4          | 342/375 [00:00&lt;00:00, 556.33it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 554.24it/s]

--------------------------------------------------------------------------------
Classifier: LogisticRegression()
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 17%|####################6                                                                                                    | 64/375 [00:00&lt;00:00, 637.03it/s]
 35%|##########################################5                                                                             | 133/375 [00:00&lt;00:00, 666.58it/s]
 54%|################################################################3                                                       | 201/375 [00:00&lt;00:00, 669.17it/s]
 72%|######################################################################################7                                 | 271/375 [00:00&lt;00:00, 680.97it/s]
 91%|#############################################################################################################1          | 341/375 [00:00&lt;00:00, 685.34it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 676.59it/s]
[[ 0.11120488 -0.19689306 -0.5442629 ]
 [-0.2752      0.0349553   0.60978675]
 [ 0.12507631  0.08030924 -0.39550171]
 ...
 [ 0.01313251  0.03206775 -0.39872752]
 [ 0.08174822  0.01639528  0.05909256]
 [ 0.06414935  0.12182382 -0.4208023 ]]
base value: 0.6303307741664606

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 18%|#####################9                                                                                                   | 68/375 [00:00&lt;00:00, 679.12it/s]
 37%|############################################4                                                                           | 139/375 [00:00&lt;00:00, 693.20it/s]
 56%|##################################################################8                                                     | 209/375 [00:00&lt;00:00, 677.50it/s]
 74%|########################################################################################9                               | 278/375 [00:00&lt;00:00, 679.32it/s]
 92%|##############################################################################################################7         | 346/375 [00:00&lt;00:00, 677.16it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 680.12it/s]

--------------------------------------------------------------------------------
Classifier: DecisionTreeClassifier(random_state=0)
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 19%|######################5                                                                                                  | 70/375 [00:00&lt;00:00, 700.00it/s]
 37%|############################################8                                                                           | 140/375 [00:00&lt;00:00, 699.42it/s]
 56%|###################################################################5                                                    | 211/375 [00:00&lt;00:00, 699.88it/s]
 75%|#########################################################################################9                              | 281/375 [00:00&lt;00:00, 691.40it/s]
 94%|################################################################################################################3       | 351/375 [00:00&lt;00:00, 691.58it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 692.93it/s]
[[ 0.035      -0.055      -0.62      ]
 [-0.03333333  0.04666667  0.34666667]
 [ 0.02666667  0.40166667 -0.06833333]
 ...
 [ 0.02666667 -0.11333333 -0.55333333]
 [-0.38333333 -0.04833333 -0.20833333]
 [ 0.02666667  0.03666667 -0.70333333]]
base value: 0.6400000000000001

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 17%|####################9                                                                                                    | 65/375 [00:00&lt;00:00, 649.60it/s]
 35%|#########################################6                                                                              | 130/375 [00:00&lt;00:00, 648.47it/s]
 53%|###############################################################3                                                        | 198/375 [00:00&lt;00:00, 661.12it/s]
 71%|#####################################################################################7                                  | 268/375 [00:00&lt;00:00, 676.42it/s]
 90%|############################################################################################################1           | 338/375 [00:00&lt;00:00, 684.32it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 676.61it/s]

--------------------------------------------------------------------------------
Classifier: RandomForestClassifier(random_state=0)
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  2%|##9                                                                                                                        | 9/375 [00:00&lt;00:04, 87.34it/s]
  5%|#####8                                                                                                                    | 18/375 [00:00&lt;00:04, 88.81it/s]
  7%|#########1                                                                                                                | 28/375 [00:00&lt;00:03, 89.16it/s]
 10%|############                                                                                                              | 37/375 [00:00&lt;00:03, 89.47it/s]
 13%|###############2                                                                                                          | 47/375 [00:00&lt;00:03, 90.31it/s]
 15%|##################5                                                                                                       | 57/375 [00:00&lt;00:03, 89.32it/s]
 18%|#####################7                                                                                                    | 67/375 [00:00&lt;00:03, 89.80it/s]
 21%|#########################                                                                                                 | 77/375 [00:00&lt;00:03, 89.90it/s]
 23%|###########################9                                                                                              | 86/375 [00:00&lt;00:03, 89.63it/s]
 26%|###############################2                                                                                          | 96/375 [00:01&lt;00:03, 90.98it/s]
 28%|##################################2                                                                                      | 106/375 [00:01&lt;00:02, 91.48it/s]
 31%|#####################################4                                                                                   | 116/375 [00:01&lt;00:02, 91.48it/s]
 34%|########################################6                                                                                | 126/375 [00:01&lt;00:02, 92.60it/s]
 36%|###########################################8                                                                             | 136/375 [00:01&lt;00:02, 93.12it/s]
 39%|###############################################1                                                                         | 146/375 [00:01&lt;00:02, 94.08it/s]
 42%|##################################################3                                                                      | 156/375 [00:01&lt;00:02, 94.16it/s]
 44%|#####################################################5                                                                   | 166/375 [00:01&lt;00:02, 93.62it/s]
 47%|########################################################7                                                                | 176/375 [00:01&lt;00:02, 94.07it/s]
 50%|############################################################                                                             | 186/375 [00:02&lt;00:02, 93.36it/s]
 52%|###############################################################2                                                         | 196/375 [00:02&lt;00:01, 93.30it/s]
 55%|##################################################################4                                                      | 206/375 [00:02&lt;00:01, 93.62it/s]
 58%|#####################################################################6                                                   | 216/375 [00:02&lt;00:01, 92.76it/s]
 60%|########################################################################9                                                | 226/375 [00:02&lt;00:01, 88.13it/s]
 63%|###########################################################################8                                             | 235/375 [00:02&lt;00:01, 88.55it/s]
 65%|##############################################################################7                                          | 244/375 [00:02&lt;00:01, 87.42it/s]
 67%|#################################################################################6                                       | 253/375 [00:02&lt;00:01, 87.41it/s]
 70%|####################################################################################5                                    | 262/375 [00:02&lt;00:01, 86.66it/s]
 72%|#######################################################################################4                                 | 271/375 [00:02&lt;00:01, 86.53it/s]
 75%|##########################################################################################3                              | 280/375 [00:03&lt;00:01, 86.49it/s]
 77%|#############################################################################################2                           | 289/375 [00:03&lt;00:00, 86.75it/s]
 79%|################################################################################################1                        | 298/375 [00:03&lt;00:00, 86.58it/s]
 82%|###################################################################################################                      | 307/375 [00:03&lt;00:00, 86.83it/s]
 85%|######################################################################################################2                  | 317/375 [00:03&lt;00:00, 89.33it/s]
 87%|#########################################################################################################5               | 327/375 [00:03&lt;00:00, 90.85it/s]
 90%|############################################################################################################7            | 337/375 [00:03&lt;00:00, 91.65it/s]
 93%|###############################################################################################################9         | 347/375 [00:03&lt;00:00, 92.15it/s]
 95%|###################################################################################################################1     | 357/375 [00:03&lt;00:00, 91.96it/s]
 98%|######################################################################################################################4  | 367/375 [00:04&lt;00:00, 91.59it/s]
100%|#########################################################################################################################| 375/375 [00:04&lt;00:00, 90.56it/s]
[[-0.21635    -0.058      -0.36585   ]
 [ 0.07893333  0.06458333  0.20628333]
 [-0.03131667  0.26613333 -0.16501667]
 ...
 [-0.01585    -0.04245    -0.3219    ]
 [-0.08548333 -0.14373333 -0.07098333]
 [-0.2299      0.0984     -0.3787    ]]
base value: 0.6402000000000001

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  2%|##9                                                                                                                        | 9/375 [00:00&lt;00:04, 89.73it/s]
  5%|#####8                                                                                                                    | 18/375 [00:00&lt;00:04, 82.31it/s]
  7%|########7                                                                                                                 | 27/375 [00:00&lt;00:04, 73.42it/s]
  9%|###########3                                                                                                              | 35/375 [00:00&lt;00:04, 74.69it/s]
 12%|##############3                                                                                                           | 44/375 [00:00&lt;00:04, 78.14it/s]
 14%|#################2                                                                                                        | 53/375 [00:00&lt;00:03, 80.82it/s]
 17%|####################1                                                                                                     | 62/375 [00:00&lt;00:03, 83.03it/s]
 19%|#######################4                                                                                                  | 72/375 [00:00&lt;00:03, 85.81it/s]
 22%|##########################6                                                                                               | 82/375 [00:00&lt;00:03, 87.42it/s]
 24%|#############################6                                                                                            | 91/375 [00:01&lt;00:03, 86.00it/s]
 27%|################################2                                                                                        | 100/375 [00:01&lt;00:03, 83.38it/s]
 29%|###################################4                                                                                     | 110/375 [00:01&lt;00:03, 85.54it/s]
 32%|######################################3                                                                                  | 119/375 [00:01&lt;00:02, 86.73it/s]
 34%|#########################################6                                                                               | 129/375 [00:01&lt;00:02, 87.94it/s]
 37%|############################################8                                                                            | 139/375 [00:01&lt;00:02, 89.35it/s]
 40%|################################################                                                                         | 149/375 [00:01&lt;00:02, 90.26it/s]
 42%|###################################################3                                                                     | 159/375 [00:01&lt;00:02, 90.86it/s]
 45%|######################################################5                                                                  | 169/375 [00:01&lt;00:02, 90.84it/s]
 48%|#########################################################7                                                               | 179/375 [00:02&lt;00:02, 91.56it/s]
 50%|############################################################9                                                            | 189/375 [00:02&lt;00:02, 92.39it/s]
 53%|################################################################2                                                        | 199/375 [00:02&lt;00:01, 93.14it/s]
 56%|###################################################################4                                                     | 209/375 [00:02&lt;00:01, 91.85it/s]
 58%|######################################################################6                                                  | 219/375 [00:02&lt;00:01, 89.99it/s]
 61%|#########################################################################8                                               | 229/375 [00:02&lt;00:01, 90.00it/s]
 64%|#############################################################################1                                           | 239/375 [00:02&lt;00:01, 90.29it/s]
 66%|################################################################################3                                        | 249/375 [00:02&lt;00:01, 89.74it/s]
 69%|###################################################################################5                                     | 259/375 [00:02&lt;00:01, 90.57it/s]
 72%|######################################################################################7                                  | 269/375 [00:03&lt;00:01, 91.05it/s]
 74%|##########################################################################################                               | 279/375 [00:03&lt;00:01, 90.69it/s]
 77%|#############################################################################################2                           | 289/375 [00:03&lt;00:00, 90.95it/s]
 80%|################################################################################################4                        | 299/375 [00:03&lt;00:00, 92.19it/s]
 82%|###################################################################################################7                     | 309/375 [00:03&lt;00:00, 92.32it/s]
 85%|######################################################################################################9                  | 319/375 [00:03&lt;00:00, 92.91it/s]
 88%|##########################################################################################################1              | 329/375 [00:03&lt;00:00, 93.82it/s]
 90%|#############################################################################################################3           | 339/375 [00:03&lt;00:00, 94.16it/s]
 93%|################################################################################################################6        | 349/375 [00:03&lt;00:00, 94.22it/s]
 96%|###################################################################################################################8     | 359/375 [00:04&lt;00:00, 94.22it/s]
 98%|#######################################################################################################################  | 369/375 [00:04&lt;00:00, 93.69it/s]
100%|#########################################################################################################################| 375/375 [00:04&lt;00:00, 89.26it/s]

--------------------------------------------------------------------------------
Classifier: XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eta=0.05, eval_metric=None,
              feature_types=None, feature_weights=None, gamma=0.2,
              grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=4, max_leaves=None,
              min_child_weight=0.005, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=100, n_jobs=None, ...)
Kernel type: &lt;class &#39;shap.explainers._tree.TreeExplainer&#39;&gt;
[[-0.26615972 -0.68707205 -4.41828418]
 [-0.48923345  0.89701019  3.28383803]
 [ 0.25992588  2.43031889 -3.09868905]
 ...
 [ 0.73170752 -0.09166955 -2.45801772]
 [ 0.14106127 -0.04692391  0.63537647]
 [ 0.07274038  1.37873462 -3.73005894]]
base value: 0.8027434151840483

--------------------------------------------------------------------------------
Classifier: MLPClassifier()
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 14%|#################4                                                                                                       | 54/375 [00:00&lt;00:00, 533.96it/s]
 29%|###################################2                                                                                    | 110/375 [00:00&lt;00:00, 545.40it/s]
 44%|#####################################################1                                                                  | 166/375 [00:00&lt;00:00, 547.06it/s]
 59%|######################################################################7                                                 | 221/375 [00:00&lt;00:00, 545.87it/s]
 74%|########################################################################################3                               | 276/375 [00:00&lt;00:00, 545.40it/s]
 88%|#########################################################################################################9              | 331/375 [00:00&lt;00:00, 545.11it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 537.94it/s]
[[ 0.11264916  0.42398509 -0.20861284]
 [-0.15303438 -0.15132639  0.44112841]
 [ 0.08128618 -0.11085575 -0.21890264]
 ...
 [ 0.0403443  -0.06015813 -0.13852486]
 [-0.01900931  0.00594019  0.06355474]
 [ 0.05387914 -0.19066848 -0.19508665]]
base value: 0.5479291430343911

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
 14%|################7                                                                                                        | 52/375 [00:00&lt;00:00, 518.63it/s]
 28%|#################################2                                                                                      | 104/375 [00:00&lt;00:00, 512.56it/s]
 42%|##################################################5                                                                     | 158/375 [00:00&lt;00:00, 524.22it/s]
 56%|###################################################################5                                                    | 211/375 [00:00&lt;00:00, 517.18it/s]
 71%|#####################################################################################1                                  | 266/375 [00:00&lt;00:00, 528.49it/s]
 86%|#######################################################################################################                 | 322/375 [00:00&lt;00:00, 535.49it/s]
100%|########################################################################################################################| 375/375 [00:00&lt;00:00, 528.29it/s]

--------------------------------------------------------------------------------
Classifier: SVC(probability=True)
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  3%|###2                                                                                                                      | 10/375 [00:00&lt;00:03, 91.86it/s]
  6%|######8                                                                                                                   | 21/375 [00:00&lt;00:03, 99.15it/s]
  9%|##########6                                                                                                              | 33/375 [00:00&lt;00:03, 105.78it/s]
 12%|##############8                                                                                                          | 46/375 [00:00&lt;00:02, 113.65it/s]
 16%|###################                                                                                                      | 59/375 [00:00&lt;00:02, 118.31it/s]
 19%|#######################5                                                                                                 | 73/375 [00:00&lt;00:02, 123.67it/s]
 23%|############################                                                                                             | 87/375 [00:00&lt;00:02, 128.01it/s]
 27%|################################3                                                                                       | 101/375 [00:00&lt;00:02, 130.52it/s]
 31%|####################################8                                                                                   | 115/375 [00:00&lt;00:02, 128.11it/s]
 34%|########################################9                                                                               | 128/375 [00:01&lt;00:01, 126.67it/s]
 38%|#############################################4                                                                          | 142/375 [00:01&lt;00:01, 129.05it/s]
 42%|#################################################9                                                                      | 156/375 [00:01&lt;00:01, 131.87it/s]
 45%|######################################################4                                                                 | 170/375 [00:01&lt;00:01, 131.93it/s]
 49%|##########################################################8                                                             | 184/375 [00:01&lt;00:01, 133.12it/s]
 53%|###############################################################6                                                        | 199/375 [00:01&lt;00:01, 136.07it/s]
 57%|####################################################################1                                                   | 213/375 [00:01&lt;00:01, 135.96it/s]
 61%|########################################################################6                                               | 227/375 [00:01&lt;00:01, 136.28it/s]
 64%|#############################################################################1                                          | 241/375 [00:01&lt;00:00, 134.00it/s]
 68%|#################################################################################6                                      | 255/375 [00:01&lt;00:00, 133.63it/s]
 72%|######################################################################################                                  | 269/375 [00:02&lt;00:00, 135.44it/s]
 76%|##########################################################################################8                             | 284/375 [00:02&lt;00:00, 138.03it/s]
 80%|###############################################################################################6                        | 299/375 [00:02&lt;00:00, 139.50it/s]
 83%|####################################################################################################1                   | 313/375 [00:02&lt;00:00, 138.03it/s]
 87%|########################################################################################################6               | 327/375 [00:02&lt;00:00, 135.36it/s]
 91%|#############################################################################################################4          | 342/375 [00:02&lt;00:00, 137.21it/s]
 95%|##################################################################################################################2     | 357/375 [00:02&lt;00:00, 139.30it/s]
 99%|####################################################################################################################### | 372/375 [00:02&lt;00:00, 140.37it/s]
100%|########################################################################################################################| 375/375 [00:02&lt;00:00, 131.54it/s]
[[-0.0023896  -0.14034342 -0.48317843]
 [ 0.00171304  0.03028929  0.33301027]
 [-0.00316234  0.04337595 -0.4879076 ]
 ...
 [-0.00146474  0.03445609 -0.30158501]
 [ 0.00175997  0.00783246  0.1961719 ]
 [-0.00322586  0.10165588 -0.40620894]]
base value: 0.6288006131620403

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  3%|####1                                                                                                                    | 13/375 [00:00&lt;00:02, 129.31it/s]
  7%|########7                                                                                                                | 27/375 [00:00&lt;00:02, 132.24it/s]
 11%|#############5                                                                                                           | 42/375 [00:00&lt;00:02, 137.15it/s]
 15%|##################3                                                                                                      | 57/375 [00:00&lt;00:02, 139.42it/s]
 19%|######################9                                                                                                  | 71/375 [00:00&lt;00:02, 137.96it/s]
 23%|###########################4                                                                                             | 85/375 [00:00&lt;00:02, 134.97it/s]
 27%|################################                                                                                        | 100/375 [00:00&lt;00:02, 137.47it/s]
 31%|####################################8                                                                                   | 115/375 [00:00&lt;00:01, 139.60it/s]
 35%|#########################################6                                                                              | 130/375 [00:00&lt;00:01, 140.58it/s]
 39%|##############################################4                                                                         | 145/375 [00:01&lt;00:01, 141.70it/s]
 43%|###################################################2                                                                    | 160/375 [00:01&lt;00:01, 142.02it/s]
 47%|########################################################                                                                | 175/375 [00:01&lt;00:01, 142.27it/s]
 51%|############################################################8                                                           | 190/375 [00:01&lt;00:01, 142.81it/s]
 55%|#################################################################6                                                      | 205/375 [00:01&lt;00:01, 142.70it/s]
 59%|######################################################################4                                                 | 220/375 [00:01&lt;00:01, 143.16it/s]
 63%|###########################################################################2                                            | 235/375 [00:01&lt;00:00, 143.48it/s]
 67%|################################################################################                                        | 250/375 [00:01&lt;00:00, 142.47it/s]
 71%|####################################################################################8                                   | 265/375 [00:01&lt;00:00, 143.00it/s]
 75%|#########################################################################################6                              | 280/375 [00:01&lt;00:00, 142.55it/s]
 79%|##############################################################################################3                         | 295/375 [00:02&lt;00:00, 138.96it/s]
 82%|##################################################################################################8                     | 309/375 [00:02&lt;00:00, 136.51it/s]
 86%|#######################################################################################################3                | 323/375 [00:02&lt;00:00, 137.38it/s]
 90%|############################################################################################################1           | 338/375 [00:02&lt;00:00, 139.02it/s]
 94%|################################################################################################################9       | 353/375 [00:02&lt;00:00, 140.57it/s]
 98%|#####################################################################################################################7  | 368/375 [00:02&lt;00:00, 141.66it/s]
100%|########################################################################################################################| 375/375 [00:02&lt;00:00, 140.30it/s]

--------------------------------------------------------------------------------
Classifier: ExtraTreesClassifier()
Kernel type: &lt;class &#39;shap.explainers._kernel.KernelExplainer&#39;&gt;

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  2%|##9                                                                                                                        | 9/375 [00:00&lt;00:04, 84.83it/s]
  5%|#####8                                                                                                                    | 18/375 [00:00&lt;00:04, 83.93it/s]
  7%|########7                                                                                                                 | 27/375 [00:00&lt;00:04, 84.01it/s]
 10%|###########7                                                                                                              | 36/375 [00:00&lt;00:04, 83.71it/s]
 12%|##############6                                                                                                           | 45/375 [00:00&lt;00:04, 81.04it/s]
 14%|#################5                                                                                                        | 54/375 [00:00&lt;00:04, 80.20it/s]
 17%|####################4                                                                                                     | 63/375 [00:00&lt;00:03, 81.43it/s]
 19%|#######################4                                                                                                  | 72/375 [00:00&lt;00:03, 82.46it/s]
 22%|##########################3                                                                                               | 81/375 [00:00&lt;00:03, 82.93it/s]
 24%|#############################2                                                                                            | 90/375 [00:01&lt;00:03, 81.86it/s]
 26%|################################2                                                                                         | 99/375 [00:01&lt;00:03, 81.85it/s]
 29%|##################################8                                                                                      | 108/375 [00:01&lt;00:03, 82.95it/s]
 31%|#####################################7                                                                                   | 117/375 [00:01&lt;00:03, 83.30it/s]
 34%|########################################6                                                                                | 126/375 [00:01&lt;00:02, 84.25it/s]
 36%|###########################################5                                                                             | 135/375 [00:01&lt;00:02, 84.70it/s]
 38%|##############################################4                                                                          | 144/375 [00:01&lt;00:02, 85.48it/s]
 41%|#################################################3                                                                       | 153/375 [00:01&lt;00:02, 85.55it/s]
 43%|####################################################2                                                                    | 162/375 [00:01&lt;00:02, 82.64it/s]
 46%|#######################################################1                                                                 | 171/375 [00:02&lt;00:02, 81.21it/s]
 48%|##########################################################                                                               | 180/375 [00:02&lt;00:02, 81.83it/s]
 50%|############################################################9                                                            | 189/375 [00:02&lt;00:02, 82.73it/s]
 53%|###############################################################8                                                         | 198/375 [00:02&lt;00:02, 84.31it/s]
 55%|##################################################################7                                                      | 207/375 [00:02&lt;00:01, 84.72it/s]
 58%|#####################################################################6                                                   | 216/375 [00:02&lt;00:01, 85.02it/s]
 60%|########################################################################6                                                | 225/375 [00:02&lt;00:01, 84.93it/s]
 62%|###########################################################################5                                             | 234/375 [00:02&lt;00:01, 84.20it/s]
 65%|##############################################################################4                                          | 243/375 [00:02&lt;00:01, 84.18it/s]
 67%|#################################################################################3                                       | 252/375 [00:03&lt;00:01, 85.01it/s]
 70%|####################################################################################2                                    | 261/375 [00:03&lt;00:01, 85.22it/s]
 72%|#######################################################################################1                                 | 270/375 [00:03&lt;00:01, 85.37it/s]
 74%|##########################################################################################                               | 279/375 [00:03&lt;00:01, 84.99it/s]
 77%|############################################################################################9                            | 288/375 [00:03&lt;00:01, 85.15it/s]
 79%|###############################################################################################8                         | 297/375 [00:03&lt;00:00, 85.56it/s]
 82%|##################################################################################################7                      | 306/375 [00:03&lt;00:00, 86.10it/s]
 84%|#####################################################################################################6                   | 315/375 [00:03&lt;00:00, 85.98it/s]
 86%|########################################################################################################5                | 324/375 [00:03&lt;00:00, 86.61it/s]
 89%|###########################################################################################################4             | 333/375 [00:03&lt;00:00, 86.35it/s]
 91%|##############################################################################################################3          | 342/375 [00:04&lt;00:00, 85.07it/s]
 94%|#################################################################################################################2       | 351/375 [00:04&lt;00:00, 85.26it/s]
 96%|####################################################################################################################1    | 360/375 [00:04&lt;00:00, 84.67it/s]
 98%|#######################################################################################################################  | 369/375 [00:04&lt;00:00, 84.93it/s]
100%|#########################################################################################################################| 375/375 [00:04&lt;00:00, 84.13it/s]
[[-0.21198333 -0.14828333 -0.27973333]
 [ 0.1073      0.055       0.1977    ]
 [ 0.13106667  0.31476667 -0.08583333]
 ...
 [-0.16245    -0.1147     -0.36285   ]
 [-0.21978333 -0.18668333 -0.23353333]
 [-0.23011667 -0.01561667 -0.39426667]]
base value: 0.6400000000000001

  0%|                                                                                                                                   | 0/375 [00:00&lt;?, ?it/s]
  2%|##9                                                                                                                        | 9/375 [00:00&lt;00:04, 87.38it/s]
  5%|#####8                                                                                                                    | 18/375 [00:00&lt;00:04, 85.43it/s]
  7%|########7                                                                                                                 | 27/375 [00:00&lt;00:04, 85.12it/s]
 10%|###########7                                                                                                              | 36/375 [00:00&lt;00:03, 85.20it/s]
 12%|##############6                                                                                                           | 45/375 [00:00&lt;00:03, 85.69it/s]
 14%|#################5                                                                                                        | 54/375 [00:00&lt;00:03, 85.11it/s]
 17%|####################4                                                                                                     | 63/375 [00:00&lt;00:03, 85.22it/s]
 19%|#######################4                                                                                                  | 72/375 [00:00&lt;00:03, 85.12it/s]
 22%|##########################3                                                                                               | 81/375 [00:00&lt;00:03, 85.56it/s]
 24%|#############################2                                                                                            | 90/375 [00:01&lt;00:03, 86.29it/s]
 26%|################################2                                                                                         | 99/375 [00:01&lt;00:03, 86.88it/s]
 29%|##################################8                                                                                      | 108/375 [00:01&lt;00:03, 86.53it/s]
 31%|#####################################7                                                                                   | 117/375 [00:01&lt;00:02, 86.44it/s]
 34%|########################################6                                                                                | 126/375 [00:01&lt;00:02, 87.23it/s]
 36%|###########################################5                                                                             | 135/375 [00:01&lt;00:02, 87.17it/s]
 38%|##############################################4                                                                          | 144/375 [00:01&lt;00:02, 86.98it/s]
 41%|#################################################3                                                                       | 153/375 [00:01&lt;00:02, 86.77it/s]
 43%|####################################################2                                                                    | 162/375 [00:01&lt;00:02, 86.20it/s]
 46%|#######################################################1                                                                 | 171/375 [00:01&lt;00:02, 86.27it/s]
 48%|##########################################################                                                               | 180/375 [00:02&lt;00:02, 85.85it/s]
 50%|############################################################9                                                            | 189/375 [00:02&lt;00:02, 86.00it/s]
 53%|###############################################################8                                                         | 198/375 [00:02&lt;00:02, 86.41it/s]
 55%|##################################################################7                                                      | 207/375 [00:02&lt;00:01, 86.17it/s]
 58%|#####################################################################6                                                   | 216/375 [00:02&lt;00:01, 85.79it/s]
 60%|########################################################################6                                                | 225/375 [00:02&lt;00:01, 85.52it/s]
 62%|###########################################################################5                                             | 234/375 [00:02&lt;00:01, 84.85it/s]
 65%|##############################################################################4                                          | 243/375 [00:02&lt;00:01, 84.85it/s]
 67%|#################################################################################3                                       | 252/375 [00:02&lt;00:01, 86.32it/s]
 70%|####################################################################################2                                    | 261/375 [00:03&lt;00:01, 86.58it/s]
 72%|#######################################################################################1                                 | 270/375 [00:03&lt;00:01, 86.88it/s]
 74%|##########################################################################################                               | 279/375 [00:03&lt;00:01, 85.97it/s]
 77%|############################################################################################9                            | 288/375 [00:03&lt;00:01, 85.89it/s]
 79%|###############################################################################################8                         | 297/375 [00:03&lt;00:00, 85.56it/s]
 82%|##################################################################################################7                      | 306/375 [00:03&lt;00:00, 86.09it/s]
 84%|#####################################################################################################6                   | 315/375 [00:03&lt;00:00, 86.23it/s]
 86%|########################################################################################################5                | 324/375 [00:03&lt;00:00, 86.82it/s]
 89%|###########################################################################################################4             | 333/375 [00:03&lt;00:00, 86.89it/s]
 91%|##############################################################################################################3          | 342/375 [00:03&lt;00:00, 86.29it/s]
 94%|#################################################################################################################2       | 351/375 [00:04&lt;00:00, 86.36it/s]
 96%|####################################################################################################################1    | 360/375 [00:04&lt;00:00, 85.67it/s]
 98%|#######################################################################################################################  | 369/375 [00:04&lt;00:00, 85.44it/s]
100%|#########################################################################################################################| 375/375 [00:04&lt;00:00, 86.03it/s]
C:\Users\kelda\Desktop\repositories\github\python-spare-code\main\examples\shap\plot_main02.py:196: UserWarning:

FigureCanvasAgg is non-interactive, and thus cannot be shown
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 28</span> <span class="c1"># Generic</span>
<span class="linenos"> 29</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 30</span> <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="linenos"> 31</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span> <span class="c1"># Sklearn</span>
<span class="linenos"> 34</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="linenos"> 35</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_iris</span>
<span class="linenos"> 36</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_breast_cancer</span>
<span class="linenos"> 37</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.naive_bayes</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="linenos"> 38</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="linenos"> 39</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="linenos"> 40</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="linenos"> 41</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.svm</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVC</span>
<span class="linenos"> 42</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExtraTreesClassifier</span>
<span class="linenos"> 43</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neural_network</span><span class="w"> </span><span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="linenos"> 44</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.calibration</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalibratedClassifierCV</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span> <span class="c1"># Xgboost</span>
<span class="linenos"> 47</span> <span class="kn">from</span><span class="w"> </span><span class="nn">xgboost</span><span class="w"> </span><span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span> <span class="c1"># ----------------------------------------</span>
<span class="linenos"> 50</span> <span class="c1"># Load data</span>
<span class="linenos"> 51</span> <span class="c1"># ----------------------------------------</span>
<span class="linenos"> 52</span> <span class="c1"># Seed</span>
<span class="linenos"> 53</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span> <span class="c1"># Load dataset</span>
<span class="linenos"> 56</span> <span class="n">bunch</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="linenos"> 57</span> <span class="n">bunch</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
<span class="linenos"> 58</span> <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bunch</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">])</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span> <span class="c1"># Create DataFrame</span>
<span class="linenos"> 61</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">bunch</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">bunch</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]],</span>
<span class="linenos"> 62</span>                     <span class="n">columns</span><span class="o">=</span><span class="n">features</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span> <span class="c1"># Create X, y</span>
<span class="linenos"> 65</span> <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">bunch</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]]</span>
<span class="linenos"> 66</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span> <span class="c1"># Filter</span>
<span class="linenos"> 69</span> <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">500</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="linenos"> 70</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span> <span class="c1"># Split dataset</span>
<span class="linenos"> 74</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> \
<span class="linenos"> 75</span>     <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span> <span class="c1"># ----------------------------------------</span>
<span class="linenos"> 79</span> <span class="c1"># Classifiers</span>
<span class="linenos"> 80</span> <span class="c1"># ----------------------------------------</span>
<span class="linenos"> 81</span> <span class="c1"># Train classifier</span>
<span class="linenos"> 82</span> <span class="n">gnb</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="linenos"> 83</span> <span class="n">llr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="linenos"> 84</span> <span class="n">dtc</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="linenos"> 85</span> <span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="linenos"> 86</span> <span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
<span class="linenos"> 87</span>     <span class="n">min_child_weight</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
<span class="linenos"> 88</span>     <span class="n">eta</span><span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
<span class="linenos"> 89</span>     <span class="n">max_depth</span><span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="linenos"> 90</span>     <span class="n">n_estimators</span><span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 91</span> <span class="n">ann</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">()</span>
<span class="linenos"> 92</span> <span class="n">svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 93</span> <span class="n">etc</span> <span class="o">=</span> <span class="n">ExtraTreesClassifier</span><span class="p">()</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span> <span class="c1"># List</span>
<span class="linenos"> 96</span> <span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">gnb</span><span class="p">,</span> <span class="n">llr</span><span class="p">,</span> <span class="n">dtc</span><span class="p">,</span> <span class="n">rfc</span><span class="p">,</span> <span class="n">xgb</span><span class="p">,</span> <span class="n">ann</span><span class="p">,</span> <span class="n">svm</span><span class="p">,</span> <span class="n">etc</span><span class="p">]</span>
<span class="linenos"> 97</span> <span class="c1">#clfs = [svm, dtc]</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span> <span class="c1"># Fit</span>
<span class="linenos">100</span> <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">clfs</span><span class="p">:</span>
<span class="linenos">101</span>     <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span> <span class="c1"># ----------------------------------------</span>
<span class="linenos">104</span> <span class="c1"># Find shap values</span>
<span class="linenos">105</span> <span class="c1"># ----------------------------------------</span>
<span class="linenos">106</span> <span class="c1"># Possible explainers:</span>
<span class="linenos">107</span> <span class="c1">#    - shap.DeepExplainer</span>
<span class="linenos">108</span> <span class="c1">#    - shap.KernelExplainer</span>
<span class="linenos">109</span> <span class="c1">#    - shap.TreeExplainer</span>
<span class="linenos">110</span> <span class="c1">#    - shap.LinearExplainer</span>
<span class="linenos">111</span> <span class="c1">#    - shap.Exact</span>
<span class="linenos">112</span> <span class="c1">#    - shap.Explainer</span>
<span class="linenos">113</span>
<span class="linenos">114</span> <span class="c1"># Import</span>
<span class="linenos">115</span> <span class="kn">import</span><span class="w"> </span><span class="nn">shap</span>
<span class="linenos">116</span>
<span class="linenos">117</span> <span class="c1"># Initialise</span>
<span class="linenos">118</span> <span class="n">shap</span><span class="o">.</span><span class="n">initjs</span><span class="p">()</span>
<span class="linenos">119</span>
<span class="linenos">120</span>
<span class="linenos">121</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict_proba</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos">122</span>     <span class="k">return</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="linenos">123</span>
<span class="linenos">124</span> <span class="c1"># Loop</span>
<span class="linenos">125</span> <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">clfs</span><span class="p">:</span>
<span class="linenos">126</span>
<span class="linenos">127</span>     <span class="k">try</span><span class="p">:</span>
<span class="linenos">128</span>         <span class="c1"># Show classifier</span>
<span class="linenos">129</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="linenos">130</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classifier: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">clf</span><span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">133</span><span class="sd">         # Create shap explainer</span>
<span class="linenos">134</span><span class="sd">         if isinstance(clf,</span>
<span class="linenos">135</span><span class="sd">             (DecisionTreeClassifier,</span>
<span class="linenos">136</span><span class="sd">              ExtraTreesClassifier,</span>
<span class="linenos">137</span><span class="sd">              XGBClassifier)):</span>
<span class="linenos">138</span><span class="sd">             # Set Tree explainer</span>
<span class="linenos">139</span><span class="sd">             explainer = shap.TreeExplainer(clf)</span>
<span class="linenos">140</span><span class="sd">         elif isinstance(clf, LogisticRegression):</span>
<span class="linenos">141</span><span class="sd">             # Masker</span>
<span class="linenos">142</span><span class="sd">             masker = shap.maskers.Independent(X_train, max_samples=100)</span>
<span class="linenos">143</span><span class="sd">             # Set Linear explainer</span>
<span class="linenos">144</span><span class="sd">             #explainer = shap.LinearExplainer(predict_proba)#, masker)</span>
<span class="linenos">145</span><span class="sd">             explainer = shap.Explainer(predict_proba, masker)</span>
<span class="linenos">146</span><span class="sd">         elif isinstance(clf, int):</span>
<span class="linenos">147</span><span class="sd">             # Set NN explainer</span>
<span class="linenos">148</span><span class="sd">             explainer = shap.DeepExplainer(clf)</span>
<span class="linenos">149</span><span class="sd">         else:</span>
<span class="linenos">150</span><span class="sd">             # Works for [svc]</span>
<span class="linenos">151</span><span class="sd">             # If too many examples (pass aux to explainer).</span>
<span class="linenos">152</span><span class="sd">             aux = shap.sample(X_train, 100)</span>
<span class="linenos">153</span><span class="sd">             # Set generic kernel explainer</span>
<span class="linenos">154</span><span class="sd">             explainer = shap.KernelExplainer(predict_proba, aux)</span>
<span class="linenos">155</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="linenos">156</span>
<span class="linenos">157</span>         <span class="c1"># Sample to speed up processing.</span>
<span class="linenos">158</span>         <span class="n">sample</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos">159</span>
<span class="linenos">160</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">):</span>
<span class="linenos">161</span>             <span class="c1"># Works for [llr, dtc, etc, xgb]</span>
<span class="linenos">162</span>             <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<span class="linenos">163</span>         <span class="k">else</span><span class="p">:</span>
<span class="linenos">164</span>             <span class="c1"># Works for all but [xgb]</span>
<span class="linenos">165</span>             <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">KernelExplainer</span><span class="p">(</span><span class="n">predict_proba</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<span class="linenos">166</span>
<span class="linenos">167</span>         <span class="c1"># Show kernel type</span>
<span class="linenos">168</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Kernel type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">explainer</span><span class="p">))</span>
<span class="linenos">169</span>
<span class="linenos">170</span>         <span class="c1"># Get shap values</span>
<span class="linenos">171</span>         <span class="c1">#shap_values = explainer(X)</span>
<span class="linenos">172</span>         <span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="linenos">173</span>
<span class="linenos">174</span>         <span class="nb">print</span><span class="p">(</span><span class="n">shap_values</span><span class="p">)</span>
<span class="linenos">175</span>
<span class="linenos">176</span>
<span class="linenos">177</span>         <span class="c1"># Show information</span>
<span class="linenos">178</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;base value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">explainer</span><span class="o">.</span><span class="n">expected_value</span><span class="p">)</span>
<span class="linenos">179</span>         <span class="c1">#print(&quot;shap_values: %s&quot; % str(shap_values.shape))</span>
<span class="linenos">180</span>
<span class="linenos">181</span>         <span class="c1"># Summary plot</span>
<span class="linenos">182</span>         <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="linenos">183</span>         <span class="n">plot_summary</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">summary_plot</span><span class="p">(</span>
<span class="linenos">184</span>             <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span>
<span class="linenos">185</span>             <span class="n">X_train</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">186</span>         <span class="p">)</span>
<span class="linenos">187</span>
<span class="linenos">188</span>         <span class="c1"># Format</span>
<span class="linenos">189</span>         <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">190</span>         <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="linenos">191</span>
<span class="linenos">192</span>     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">193</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
<span class="linenos">194</span>
<span class="linenos">195</span> <span class="c1"># Show</span>
<span class="linenos">196</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  31.244 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-shap-plot-main02-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/0b34679a3ec8e873aef54c1019cd0c01/plot_main02.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_main02.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/90855a20b7d7ad59d2b23ab910746af5/plot_main02.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_main02.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_main01.html" class="btn btn-neutral float-left" title="01. A practical example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plot_main04.html" class="btn btn-neutral float-right" title="04. Basic example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2025, Bernard Hernandez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>